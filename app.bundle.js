!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const s={PEN:"pen",ERASER:"eraser",BUCKET:"bucket",REPLACE:"replace"},o={B:98,E:101,P:112,R:114};class l{constructor(t,e,i,o){this.pixels=[...Array(t)].map(()=>Array(t).fill("transparent")),this.getColor=e,this.getPixelCount=o,this.pixelCount=t,this.getActiveTool=i,this.pixelSize=0,this.addPixel=this.addPixel.bind(this),this.setPaint=this.setPaint.bind(this),this.erasePixel=this.erasePixel.bind(this),this.paintBucket=this.paintBucket.bind(this),this.eventHandler=this.eventHandler.bind(this),this.floodFill=this.floodFill.bind(this),this.getPixelSize=this.getPixelSize.bind(this),this.replaceColor=this.replaceColor.bind(this),this.setPixels=this.setPixels.bind(this),this.paint=!1,this.HANDLERS_MAP={[s.PEN]:this.addPixel,[s.ERASER]:this.erasePixel,[s.BUCKET]:this.paintBucket,[s.REPLACE]:this.replaceColor}}subscribe(t){t.addSubscriber(this),this.publisher=t}setPixels(t){this.pixels=t}setPaint(){this.paint?this.paint=!1:this.paint=!0}getPixelSize(){return this.pixelCount!==this.getPixelCount()&&(this.pixels=[...Array(this.getPixelCount())].map(()=>Array(this.getPixelCount()).fill("transparent")),this.clearCanvas(),this.pixelCount=this.getPixelCount()),+document.querySelector("canvas").width/this.getPixelCount()}addPixel(t){if(!1===this.paint&&"mousemove"===t.type)return;const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize());this.pixels[e][i]=this.getColor(),this.publisher.updateState(this.pixels),this.clearCanvas(),this.drawPixels()}drawPixels(){const t=document.getElementById("canvas").getContext("2d");for(let e=0;e<this.pixelCount;e++)for(let i=0;i<this.pixelCount;i++){t.fillStyle=this.pixels[e][i];const s=e*this.getPixelSize(),o=i*this.getPixelSize();t.fillRect(s,o,this.getPixelSize(),this.getPixelSize())}}clearCanvas(){const t=document.getElementById("canvas"),e=t.getContext("2d"),i=t.width,s=t.height;e.clearRect(0,0,i,s)}erasePixel(t){if(!1===this.paint&&"mousemove"===t.type)return;const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize());this.pixels[e][i]="transparent",this.publisher.updateState(this.pixels),this.clearCanvas(),this.drawPixels()}paintBucket(t){if(!1===this.paint&&"mousemove"===t.type)return;const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize());this.pixels[e][i]!==this.getColor()&&(this.floodFill(e,i,this.pixels[e][i],this.getColor()),this.publisher.updateState(this.pixels),this.clearCanvas(),this.drawPixels())}floodFill(t,e,i,s){t>this.pixels.length-1||t<0||e>this.pixels.length-1||e<0||this.pixels[t][e]===i&&(this.pixels[t][e]=s,this.floodFill(t-1,e,i,s),this.floodFill(t+1,e,i,s),this.floodFill(t,e-1,i,s),this.floodFill(t,e+1,i,s))}replaceColor(t){if(!1===this.paint&&"mousemove"===t.type)return;const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize()),s=this.pixels[e][i];for(let t=0;t<this.pixelCount;t++)for(let e=0;e<this.pixelCount;e++)this.pixels[t][e]===s&&(this.pixels[t][e]=this.getColor());this.publisher.updateState(this.pixels),this.clearCanvas(),this.drawPixels()}eventHandler(t){return this.HANDLERS_MAP[this.getActiveTool()](t)}addCanvas(){const t=document.createElement("canvas");t.id="canvas",t.addEventListener("click",this.eventHandler),t.addEventListener("mousedown",this.setPaint),t.addEventListener("mouseup",this.setPaint),t.addEventListener("mousemove",this.eventHandler),t.addEventListener("mouseleave",()=>{this.paint=!1}),t.width="500",t.height="500",t.style.border="1px solid black",document.querySelector("body").appendChild(t)}}class n{constructor(t){this.onColorChange=e=>{const i=e.target.value;t(i)}}addPalette(){const t=document.createElement("div"),e=document.createElement("input");t.id="palette",e.type="color",e.id="primary-color",e.addEventListener("change",this.onColorChange);const i=document.querySelector("body");t.appendChild(e),i.appendChild(t)}}class a{constructor(t,e){this.setActiveTool=function(e){let i=null;if("mousemove"===e.type)i=s[`${e.target.id}`.toUpperCase()];else switch(e.which){case o.P:i=s.BUCKET;break;case o.E:i=s.ERASER;break;case o.B:i=s.BUCKET;break;case o.R:i=s.REPLACE;break;default:return null}t(i)},this.setPixelCount=function(t){const i=t.target.value;e(i)}}addToolbox(){const t=document.createElement("input"),e=document.createElement("Label");e.setAttribute("for",t),e.innerHTML="Canvas side size: ",t.id="size",t.type="number",t.min=1,t.max=500,t.value=32;const i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),n=document.createElement("div");i.id="toolbox",s.id="pen",o.id="eraser",l.id="bucket",n.id="replace",s.innerText="Pen",o.innerText="Eraser",l.innerText="Bucket",n.innerText="Replace",t.addEventListener("change",this.setPixelCount),i.addEventListener("click",this.setActiveTool),i.appendChild(s),i.appendChild(o),i.appendChild(l),i.appendChild(n),document.querySelector("body").addEventListener("keypress",this.setActiveTool),document.querySelector("body").appendChild(e),document.querySelector("body").appendChild(t),document.querySelector("body").appendChild(i)}}class r{constructor(){this.subscribers=[],this.pixelState=[]}addSubscriber(t){this.subscribers.push(t)}updateState(t){this.pixelState=t,localStorage.setItem("pixelState",JSON.stringify(this.pixelState))}}(new class{constructor(){this.color="#000000",this.pixelCount=32,this.getColor=this.getColor.bind(this),this.onColorChange=this.onColorChange.bind(this),this.getActiveTool=this.getActiveTool.bind(this),this.setActiveTool=this.setActiveTool.bind(this),this.getPixelCount=this.getPixelCount.bind(this),this.setPixelCount=this.setPixelCount.bind(this),this.processLoad=this.processLoad.bind(this),this.activeTool="pen",this.canvas=null,this.palette=null,this.toolbox=null}onColorChange(t){this.color=t}getColor(){return this.color}getActiveTool(){return this.activeTool}setActiveTool(t){this.activeTool=t}getPixelCount(){return this.pixelCount}setPixelCount(t){this.pixelCount=+t}processLoad(){this.canvas&&localStorage.getItem("pixelState")&&(this.canvas.setPixels(JSON.parse(localStorage.getItem("pixelState"))),this.canvas.drawPixels())}processUnload(){if(localStorage.getItem("innerHtml"))localStorage.removeItem("innerHtml"),localStorage.removeItem("activeTool");else{const t=document.documentElement.innerHTML;localStorage.setItem("innerHtml",t),localStorage.setItem("activeTool",this.activeTool)}}start(){this.palette=new n(this.onColorChange),this.palette.addPalette(),this.toolbox=new a(this.setActiveTool,this.setPixelCount),this.toolbox.addToolbox(),this.canvas=new l(this.pixelCount,this.getColor,this.getActiveTool,this.getPixelCount),this.canvas.addCanvas();const t=new r;this.canvas.subscribe(t),window.addEventListener("load",this.processLoad),window.addEventListener("unload",this.processUnload)}}).start()}]);
//# sourceMappingURL=app.bundle.js.map