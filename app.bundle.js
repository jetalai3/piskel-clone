!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const s={PEN:"pen",ERASER:"eraser",BUCKET:"bucket",REPLACE:"replace",LIGHTEN:"lighten",RECTANGLE:"rectangle"},o={B:98,E:101,P:112,R:114,L:108,M:109};class n{constructor(t,e,i,o){this.pixels=[...Array(t)].map(()=>Array(t).fill("transparent")),this.getColor=e,this.getPixelCount=o,this.pixelCount=t,this.getActiveTool=i,this.pixelSize=0,this.addPixel=this.addPixel.bind(this),this.setPaint=this.setPaint.bind(this),this.erasePixel=this.erasePixel.bind(this),this.paintBucket=this.paintBucket.bind(this),this.eventHandler=this.eventHandler.bind(this),this.floodFill=this.floodFill.bind(this),this.getPixelSize=this.getPixelSize.bind(this),this.replaceColor=this.replaceColor.bind(this),this.setPixels=this.setPixels.bind(this),this.showCoords=this.showCoords.bind(this),this.lighten=this.lighten.bind(this),this.rectangle=this.rectangle.bind(this),this.paint=!1,this.X1=0,this.Y1=0,this.HANDLERS_MAP={[s.PEN]:this.addPixel,[s.ERASER]:this.erasePixel,[s.BUCKET]:this.paintBucket,[s.REPLACE]:this.replaceColor,[s.LIGHTEN]:this.lighten,[s.RECTANGLE]:this.rectangle}}subscribe(t){t.addSubscriber(this),this.publisher=t}setPixels(t){this.pixels=t}setPaint(){this.paint?this.paint=!1:this.paint=!0}getPixelSize(){return this.pixelCount!==this.getPixelCount()&&(this.pixels=[...Array(this.getPixelCount())].map(()=>Array(this.getPixelCount()).fill("transparent")),this.clearCanvas(),this.pixelCount=this.getPixelCount()),+document.querySelector("canvas").width/this.getPixelCount()}addPixel(t){if(!1===this.paint&&"mousemove"===t.type)return;const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize());this.pixels[e][i]=this.getColor(),this.publisher.updateState(this.pixels),this.clearCanvas(),this.drawPixels()}drawPixels(){const t=document.getElementById("canvas").getContext("2d");for(let e=0;e<this.pixelCount;e++)for(let i=0;i<this.pixelCount;i++){t.fillStyle=this.pixels[e][i];const s=e*this.getPixelSize(),o=i*this.getPixelSize();t.fillRect(s,o,this.getPixelSize(),this.getPixelSize())}}clearCanvas(){const t=document.getElementById("canvas"),e=t.getContext("2d"),i=t.width,s=t.height;e.clearRect(0,0,i,s)}erasePixel(t){if(!1===this.paint&&"mousemove"===t.type)return;const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize());this.pixels[e][i]="transparent",this.publisher.updateState(this.pixels),this.clearCanvas(),this.drawPixels()}paintBucket(t){if(!1===this.paint&&"mousemove"===t.type)return;const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize());this.pixels[e][i]!==this.getColor()&&(this.floodFill(e,i,this.pixels[e][i],this.getColor()),this.publisher.updateState(this.pixels),this.clearCanvas(),this.drawPixels())}floodFill(t,e,i,s){t>this.pixels.length-1||t<0||e>this.pixels.length-1||e<0||this.pixels[t][e]===i&&(this.pixels[t][e]=s,this.floodFill(t-1,e,i,s),this.floodFill(t+1,e,i,s),this.floodFill(t,e-1,i,s),this.floodFill(t,e+1,i,s))}replaceColor(t){if(!1===this.paint&&"mousemove"===t.type)return;const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize()),s=this.pixels[e][i];for(let t=0;t<this.pixelCount;t++)for(let e=0;e<this.pixelCount;e++)this.pixels[t][e]===s&&(this.pixels[t][e]=this.getColor());this.publisher.updateState(this.pixels),this.clearCanvas(),this.drawPixels()}showCoords(t){const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize());document.getElementById("coords").innerText=`${e+1}:${i+1}`}lighten(t){if(!1===this.paint&&"mousemove"===t.type)return;const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize()),s=this.pixels[e][i];let o=0,n=0,l=0;4===s.length?(o=`0x${s[1]}${s[1]}`,n=`0x${s[2]}${s[2]}`,l=`0x${s[3]}${s[3]}`):7===s.length&&(o=`0x${s[1]}${s[2]}`,n=`0x${s[3]}${s[4]}`,l=`0x${s[5]}${s[6]}`),o/=255,n/=255,l/=255;const a=Math.min(o,n,l),r=Math.max(o,n,l),h=r-a;let d=0,c=0,p=0;d=0===h?0:r===o?(n-l)/h%6:r===n?(l-o)/h+2:(o-n)/h+4,(d=Math.round(60*d))<0&&(d+=360),p=(r+a)/2,c=+(100*(c=0===h?0:h/(1-Math.abs(2*p-1)))).toFixed(1),(p=+(100*p).toFixed(1))<=90&&(p+=10),c/=100,p/=100;const u=(1-Math.abs(2*p-1))*c,g=u*(1-Math.abs(d/60%2-1)),x=p-u/2;o=0,n=0,l=0,d>=0&&d<60?(o=u,n=g,l=0):d>=60&&d<120?(o=g,n=u,l=0):d>=120&&d<180?(o=0,n=u,l=g):d>=180&&d<240?(o=0,n=g,l=u):d>=240&&d<300?(o=g,n=0,l=u):d>=300&&d<360&&(o=u,n=0,l=g),o=Math.round(255*(o+x)).toString(16),n=Math.round(255*(n+x)).toString(16),l=Math.round(255*(l+x)).toString(16),1===o.length&&(o=`0${o}`),1===n.length&&(n=`0${n}`),1===l.length&&(l=`0${l}`),this.pixels[e][i]=`#${o}${n}${l}`,this.publisher.updateState(this.pixels),this.clearCanvas(),this.drawPixels()}rectangle(t){if("mousedown"===t.type)this.X1=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),this.Y1=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize());else if("mouseup"===t.type){const e=Math.floor((t.pageX-t.target.offsetLeft)/this.getPixelSize()),i=Math.floor((t.pageY-t.target.offsetTop)/this.getPixelSize());for(let t=this.X1;t<e;t++)for(let e=this.Y1;e<i;e++)this.pixels[t][e]=this.getColor()}this.publisher.updateState(this.pixels),this.clearCanvas(),this.drawPixels()}eventHandler(t){return(0,this.HANDLERS_MAP[this.getActiveTool()])(t)}addCanvas(){const t=document.createElement("canvas");t.id="canvas",t.addEventListener("click",this.eventHandler),t.addEventListener("mousedown",this.setPaint),t.addEventListener("mouseup",this.setPaint),t.addEventListener("mousedown",this.eventHandler),t.addEventListener("mouseup",this.eventHandler),t.addEventListener("mousemove",this.eventHandler),t.addEventListener("mouseleave",()=>{this.paint=!1}),t.addEventListener("mousemove",this.showCoords),t.width="500",t.height="500",t.style.border="1px solid black",document.querySelector("body").appendChild(t);const e=document.createElement("label");e.id="coords",t.addEventListener("mouseleave",()=>{e.innerText=""}),document.querySelector("body").appendChild(e)}}class l{constructor(t){this.onColorChange=e=>{const i=e.target.value;t(i)}}addPalette(){const t=document.createElement("div"),e=document.createElement("input");t.id="palette",e.type="color",e.id="primary-color",e.addEventListener("change",this.onColorChange);const i=document.querySelector("body");t.appendChild(e),i.appendChild(t)}}class a{constructor(t,e){this.setActiveTool=function(e){let i=null;if("click"===e.type)i=s[`${e.target.id}`.toUpperCase()];else switch(e.which){case o.P:i=s.PEN;break;case o.E:i=s.ERASER;break;case o.B:i=s.BUCKET;break;case o.R:i=s.REPLACE;break;case o.L:i=s.LIGHTEN;break;case o.M:i=s.RECTANGLE;break;default:return null}t(i)},this.setPixelCount=function(t){const i=t.target.value;e(i)}}addToolbox(){const t=document.createElement("input"),e=document.createElement("Label");e.setAttribute("for",t),e.innerHTML="Canvas side size: ",t.id="size",t.type="number",t.min=1,t.max=500,t.value=32;const i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),n=document.createElement("div"),l=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");i.id="toolbox",s.id="pen",o.id="eraser",n.id="bucket",l.id="replace",a.id="lighten",r.id="rectangle",s.innerText="Pen",o.innerText="Eraser",n.innerText="Bucket",l.innerText="Replace",a.innerText="Lighten",r.innerText="Rectangle",t.addEventListener("change",this.setPixelCount),i.addEventListener("click",this.setActiveTool),i.appendChild(s),i.appendChild(o),i.appendChild(n),i.appendChild(l),i.appendChild(a),i.appendChild(r),document.querySelector("body").addEventListener("keypress",this.setActiveTool),document.querySelector("body").appendChild(e),document.querySelector("body").appendChild(t),document.querySelector("body").appendChild(i)}}class r{constructor(){this.subscribers=[],this.pixelState=[]}addSubscriber(t){this.subscribers.push(t)}updateState(t){this.pixelState=t,localStorage.setItem("pixelState",JSON.stringify(this.pixelState))}}(new class{constructor(){this.color="#000000",this.pixelCount=32,this.getColor=this.getColor.bind(this),this.onColorChange=this.onColorChange.bind(this),this.getActiveTool=this.getActiveTool.bind(this),this.setActiveTool=this.setActiveTool.bind(this),this.getPixelCount=this.getPixelCount.bind(this),this.setPixelCount=this.setPixelCount.bind(this),this.processLoad=this.processLoad.bind(this),this.activeTool="pen",this.canvas=null,this.palette=null,this.toolbox=null}onColorChange(t){this.color=t}getColor(){return this.color}getActiveTool(){return this.activeTool}setActiveTool(t){this.activeTool=t}getPixelCount(){return this.pixelCount}setPixelCount(t){this.pixelCount=+t}processLoad(){this.canvas&&localStorage.getItem("pixelState")&&(this.canvas.setPixels(JSON.parse(localStorage.getItem("pixelState"))),this.canvas.drawPixels())}processUnload(){if(localStorage.getItem("innerHtml"))localStorage.removeItem("innerHtml"),localStorage.removeItem("activeTool");else{const t=document.documentElement.innerHTML;localStorage.setItem("innerHtml",t),localStorage.setItem("activeTool",this.activeTool)}}start(){this.palette=new l(this.onColorChange),this.palette.addPalette(),this.toolbox=new a(this.setActiveTool,this.setPixelCount),this.toolbox.addToolbox(),this.canvas=new n(this.pixelCount,this.getColor,this.getActiveTool,this.getPixelCount),this.canvas.addCanvas();const t=new r;this.canvas.subscribe(t),window.addEventListener("load",this.processLoad),window.addEventListener("unload",this.processUnload)}}).start()}]);
//# sourceMappingURL=app.bundle.js.map